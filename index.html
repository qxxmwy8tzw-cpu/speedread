<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SpeedRead">
  <meta name="theme-color" content="#000000">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- PWA Links -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">

  <title>SpeedRead</title>
</head>
<body>
  <!-- Library View -->
  <div id="library-view" class="view active">
    <header class="header">
      <h1>SpeedRead</h1>
      <button id="add-pdf-btn" class="icon-btn" aria-label="Add PDF">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </header>

    <main class="library-content">
      <div id="library-grid" class="library-grid">
        <!-- PDF items will be inserted here -->
      </div>

      <div id="empty-library" class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
        </svg>
        <p>No books yet</p>
        <p class="hint">Tap + to import a PDF</p>
      </div>
    </main>

    <input type="file" id="pdf-input" accept="application/pdf" hidden>
  </div>

  <!-- Chapter List View -->
  <div id="chapter-view" class="view">
    <header class="header">
      <button id="back-to-library" class="icon-btn" aria-label="Back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h1 id="chapter-view-title">Chapters</h1>
      <button id="delete-book-btn" class="icon-btn danger" aria-label="Delete">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      </button>
    </header>

    <main class="chapter-content">
      <ul id="chapter-list" class="chapter-list">
        <!-- Chapters will be inserted here -->
      </ul>
    </main>
  </div>

  <!-- Speed Reader View -->
  <div id="reader-view" class="view">
    <div id="reader-tap-area" class="reader-tap-area">
      <div id="word-display" class="word-display">
        <div class="word-container">
          <span id="word-before"></span><span id="word-focus"></span><span id="word-after"></span>
        </div>
        <div class="focus-line"></div>
      </div>

      <div id="progress-bar" class="progress-bar">
        <div id="progress-fill" class="progress-fill"></div>
      </div>
    </div>

    <div id="reader-controls" class="reader-controls">
      <div class="controls-row controls-main">
        <button id="close-reader" class="control-btn" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <button id="restart-chapter" class="control-btn" aria-label="Restart chapter">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 4v6h6"></path>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
        </button>

        <button id="set-bookmark" class="control-btn" aria-label="Set bookmark">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
          </svg>
        </button>

        <button id="goto-bookmark" class="control-btn" aria-label="Go to bookmark" disabled>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            <polyline points="9 10 12 13 15 10"></polyline>
          </svg>
        </button>

        <div class="wpm-control">
          <button id="wpm-down" class="control-btn" aria-label="Decrease speed">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
          <span id="wpm-display">300 WPM</span>
          <button id="wpm-up" class="control-btn" aria-label="Increase speed">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
        </div>

        <button id="play-pause" class="control-btn play-btn" aria-label="Play/Pause">
          <svg id="play-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          <svg id="pause-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" style="display:none">
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
          </svg>
        </button>
      </div>

      <div class="controls-row rewind-control">
        <button id="rewind-action" class="control-btn" aria-label="Rewind">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="11 19 2 12 11 5 11 19"></polygon>
            <polygon points="22 19 13 12 22 5 22 19"></polygon>
          </svg>
        </button>
        <input type="range" id="rewind-slider" min="10" max="300" value="50" step="10">
        <span id="rewind-display">50</span>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p id="loading-text">Processing PDF...</p>
  </div>

  <!-- PDF.js from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <!-- App Scripts -->
  <script src="js/storage.js"></script>
  <script src="js/pdfExtractor.js"></script>
  <script src="js/llamaService.js"></script>
  <script src="js/chapterDetector.js"></script>
  <script src="js/speedReader.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
